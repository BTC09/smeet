<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>SMEET CASINO | PLINKO DELUXE</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'Inter', system-ui, sans-serif;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      background: linear-gradient(145deg, #03050a 0%, #0f1a2f 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 10px;
      position: relative;
      overflow-x: hidden;
    }

    /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–≤–µ–∑–¥—ã –Ω–∞ —Ñ–æ–Ω–µ */
    body::before {
      content: '';
      position: fixed;
      width: 100%;
      height: 100%;
      background: radial-gradient(2px 2px at 20px 30px, #fff, rgba(0,0,0,0)),
                  radial-gradient(2px 2px at 40px 70px, #fff, rgba(0,0,0,0)),
                  radial-gradient(3px 3px at 90px 40px, #fff, rgba(0,0,0,0)),
                  radial-gradient(1px 1px at 160px 120px, #fff, rgba(0,0,0,0)),
                  radial-gradient(2px 2px at 230px 190px, #ffd966, rgba(0,0,0,0)),
                  radial-gradient(4px 4px at 320px 250px, #fff, rgba(0,0,0,0)),
                  radial-gradient(2px 2px at 410px 80px, #ffd966, rgba(0,0,0,0)),
                  radial-gradient(3px 3px at 500px 340px, #fff, rgba(0,0,0,0)),
                  radial-gradient(2px 2px at 600px 200px, #ffd966, rgba(0,0,0,0)),
                  radial-gradient(4px 4px at 720px 450px, #fff, rgba(0,0,0,0)),
                  radial-gradient(2px 2px at 800px 150px, #ffd966, rgba(0,0,0,0)),
                  radial-gradient(3px 3px at 880px 520px, #fff, rgba(0,0,0,0));
      background-size: 200px 200px;
      opacity: 0.5;
      animation: starsFloat 120s linear infinite;
      pointer-events: none;
    }

    @keyframes starsFloat {
      0% { transform: translateY(0); }
      100% { transform: translateY(-200px); }
    }

    .welcome-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 30% 50%, #1e2b4a, #030614);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      transition: opacity 1s ease;
    }

    .welcome-content {
      text-align: center;
      padding: 20px;
      position: relative;
    }

    .welcome-content::before {
      content: '';
      position: absolute;
      top: -50px;
      left: -50px;
      right: -50px;
      bottom: -50px;
      background: radial-gradient(circle at center, rgba(255,215,0,0.2) 0%, transparent 70%);
      animation: pulseGlow 3s infinite;
    }

    @keyframes pulseGlow {
      0% { opacity: 0.3; transform: scale(0.95); }
      50% { opacity: 0.7; transform: scale(1.05); }
      100% { opacity: 0.3; transform: scale(0.95); }
    }

    .welcome-title {
      font-size: clamp(70px, 18vw, 140px);
      font-weight: 900;
      background: linear-gradient(135deg, #fff5c0, #ffd966, #ffaa33, #ffd966);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 40px #ffaa33, 0 0 80px #ff6600;
      letter-spacing: 8px;
      margin-bottom: 20px;
      animation: slideInDown 1.2s ease;
      line-height: 1;
      filter: drop-shadow(0 20px 20px #00000066);
    }

    .welcome-subtitle {
      font-size: clamp(24px, 6vw, 36px);
      color: #fff;
      text-shadow: 0 0 20px #4f9fff, 0 0 40px #2f6fbf;
      animation: slideInUp 1.2s ease 0.2s both;
      letter-spacing: 3px;
    }

    .loading-dots {
      margin-top: 40px;
      display: flex;
      justify-content: center;
      gap: 20px;
    }

    .loading-dots span {
      width: clamp(18px, 5vw, 24px);
      height: clamp(18px, 5vw, 24px);
      background: linear-gradient(145deg, #ffd966, #ffaa33);
      border-radius: 50%;
      animation: bounceDeluxe 1.4s infinite;
      box-shadow: 0 0 30px #ffaa33, 0 0 60px #ff6600;
    }

    .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
    .loading-dots span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes bounceDeluxe {
      0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; filter: brightness(0.8); }
      40% { transform: scale(1.3); opacity: 1; filter: brightness(1.3); }
    }

    @keyframes slideInDown {
      from { transform: translateY(-150px); opacity: 0; filter: blur(10px); }
      to { transform: translateY(0); opacity: 1; filter: blur(0); }
    }

    @keyframes slideInUp {
      from { transform: translateY(150px); opacity: 0; filter: blur(10px); }
      to { transform: translateY(0); opacity: 1; filter: blur(0); }
    }

    .app {
      width: 100%;
      max-width: 1000px;
      background: rgba(20, 28, 40, 0.75);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: clamp(32px, 6vw, 56px);
      padding: clamp(18px, 3.5vw, 26px);
      box-shadow: 0 30px 50px rgba(0, 0, 0, 0.8), 0 0 0 2px rgba(255, 215, 0, 0.2) inset, 0 0 30px rgba(255, 200, 50, 0.3);
      border: 1px solid rgba(255, 215, 0, 0.4);
      opacity: 0;
      transform: scale(0.95) translateY(20px);
      transition: opacity 0.8s ease, transform 0.8s ease;
      position: relative;
    }

    .app.visible {
      opacity: 1;
      transform: scale(1) translateY(0);
    }

    .header {
      background: rgba(15, 25, 35, 0.7);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border-radius: 100px;
      padding: clamp(12px, 2.5vw, 16px) clamp(22px, 4vw, 32px);
      margin-bottom: clamp(18px, 3vw, 24px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1px solid rgba(255, 215, 0, 0.5);
      box-shadow: 0 8px 20px #00000055, 0 0 20px rgba(255, 200, 0, 0.2) inset;
      flex-wrap: wrap;
      gap: 12px;
    }

    .balance-block {
      display: flex;
      align-items: center;
      gap: clamp(12px, 2.5vw, 22px);
      background: linear-gradient(145deg, #1a2638, #0f1a28);
      padding: clamp(6px, 1.8vw, 8px) clamp(22px, 5vw, 35px) clamp(6px, 1.8vw, 8px) clamp(18px, 3.5vw, 25px);
      border-radius: 60px;
      border: 1px solid #ffd966;
      box-shadow: 0 0 15px #ffd96666;
    }

    .stars-icon {
      font-size: clamp(28px, 6vw, 36px);
      filter: drop-shadow(0 0 12px gold) drop-shadow(0 0 25px orange);
      animation: starTwinkle 2s infinite;
    }

    @keyframes starTwinkle {
      0% { filter: drop-shadow(0 0 8px gold) drop-shadow(0 0 15px orange); }
      50% { filter: drop-shadow(0 0 18px gold) drop-shadow(0 0 30px #ff8800); }
      100% { filter: drop-shadow(0 0 8px gold) drop-shadow(0 0 15px orange); }
    }

    .balance-value {
      font-size: clamp(28px, 6vw, 40px);
      font-weight: 800;
      background: linear-gradient(135deg, #ffd966, #ffb347);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 15px #ffaa33;
    }

    .add-stars-btn {
      background: linear-gradient(145deg, #2a3f60, #1a2b40);
      border: 2px solid #ffd966;
      color: #ffd966;
      font-size: clamp(16px, 3.5vw, 22px);
      font-weight: 700;
      padding: clamp(8px, 2.2vw, 12px) clamp(22px, 5vw, 35px);
      border-radius: 60px;
      cursor: pointer;
      transition: 0.2s;
      box-shadow: 0 6px 0 #0f1a2a, 0 0 20px #ffd96666;
      display: flex;
      align-items: center;
      gap: 10px;
      white-space: nowrap;
      backdrop-filter: blur(4px);
    }

    .add-stars-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 0 #0f1a2a, 0 0 30px #ffd966;
    }

    .add-stars-btn:active {
      transform: translateY(4px);
      box-shadow: 0 2px 0 #0f1a2a, 0 0 20px #ffd966;
    }

    .games-menu {
      display: flex;
      flex-direction: column;
      gap: 18px;
      padding: 20px 0;
    }

    .game-menu-item {
      background: rgba(30, 45, 65, 0.6);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: 3px solid rgba(255, 215, 0, 0.8);
      border-radius: 70px;
      padding: clamp(22px, 5vw, 32px);
      font-size: clamp(34px, 7vw, 52px);
      font-weight: 800;
      background: linear-gradient(145deg, #ffe5a3, #ffc800);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      cursor: pointer;
      transition: 0.3s;
      text-transform: uppercase;
      letter-spacing: 4px;
      text-align: center;
      box-shadow: 0 10px 0 #0f1a2a, 0 0 30px rgba(255, 215, 0, 0.5);
      border-image: linear-gradient(145deg, #ffd966, #ffaa33) 1;
      position: relative;
      overflow: hidden;
    }

    .game-menu-item::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at center, rgba(255,255,255,0.3), transparent 70%);
      animation: shine 6s infinite;
      pointer-events: none;
    }

    @keyframes shine {
      0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); opacity: 0; }
      20% { opacity: 0.5; }
      40% { transform: translateX(100%) translateY(100%) rotate(45deg); opacity: 0; }
      100% { opacity: 0; }
    }

    .game-menu-item:active {
      transform: translateY(6px);
      box-shadow: 0 4px 0 #0f1a2a, 0 0 40px #ffd966;
    }

    .game-menu-item.disabled {
      opacity: 0.3;
      filter: grayscale(1);
      pointer-events: none;
    }

    #plinkoContainer {
      display: none;
    }

    #plinkoContainer.active {
      display: block;
      animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.98); }
      to { opacity: 1; transform: scale(1); }
    }

    .back-to-menu {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      background: rgba(30, 45, 65, 0.6);
      backdrop-filter: blur(8px);
      border: 2px solid #ffd966;
      color: #ffd966;
      font-size: clamp(18px, 3.5vw, 24px);
      font-weight: 700;
      padding: clamp(10px, 2.2vw, 15px) clamp(22px, 5vw, 32px);
      border-radius: 60px;
      cursor: pointer;
      margin-bottom: 22px;
      transition: 0.2s;
      box-shadow: 0 6px 0 #0f1a2a, 0 0 20px #ffd96666;
    }

    .back-to-menu span {
      font-size: clamp(26px, 5vw, 34px);
      filter: drop-shadow(0 0 8px gold);
    }

    .canvas-wrapper {
      width: 100%;
      aspect-ratio: 952/700;
      margin-bottom: 22px;
      border-radius: clamp(28px, 5vw, 42px);
      overflow: hidden;
      background: #030b14;
      box-shadow: 0 20px 40px #000000cc, 0 0 0 2px rgba(255, 215, 0, 0.4) inset, 0 0 40px rgba(255, 200, 0, 0.3);
      position: relative;
    }

    .canvas-wrapper::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 30% 40%, rgba(255,215,0,0.1), transparent 70%);
      pointer-events: none;
      z-index: 2;
    }

    canvas {
      display: block;
      width: 100%;
      height: 100%;
      background: #030b14;
    }

    .plinko-controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(25, 38, 52, 0.7);
      backdrop-filter: blur(8px);
      padding: clamp(15px, 3vw, 22px) clamp(22px, 4vw, 32px);
      border-radius: 70px;
      border: 1px solid rgba(255, 215, 0, 0.6);
      box-shadow: 0 10px 20px #00000066, 0 0 20px rgba(255, 200, 0, 0.2) inset;
      flex-wrap: wrap;
      gap: 15px;
    }

    .bet-section {
      display: flex;
      align-items: center;
      gap: clamp(12px, 2.5vw, 28px);
      background: rgba(15, 25, 38, 0.8);
      backdrop-filter: blur(4px);
      padding: clamp(6px, 1.8vw, 8px) clamp(18px, 3.5vw, 28px);
      border-radius: 60px;
      flex: 1;
      min-width: 260px;
      border: 1px solid #ffd96688;
      box-shadow: 0 0 15px #ffd96633 inset;
    }

    .bet-label {
      color: #fff;
      font-size: clamp(16px, 2.8vw, 22px);
      font-weight: 500;
      white-space: nowrap;
      text-shadow: 0 0 8px #ffd966;
      letter-spacing: 1px;
    }

    .bet-input {
      background: linear-gradient(145deg, #1a2b42, #0f1a2a);
      border: 2px solid #ffd966;
      color: #ffd966;
      font-size: clamp(24px, 4vw, 30px);
      font-weight: 700;
      width: min(140px, 28vw);
      padding: clamp(8px, 1.8vw, 12px) clamp(12px, 2.2vw, 20px);
      border-radius: 60px;
      text-align: center;
      outline: none;
      box-shadow: 0 0 15px #ffd96666;
    }

    .bet-input:focus {
      box-shadow: 0 0 30px #ffd966;
    }

    .drop-ball-btn {
      background: linear-gradient(145deg, #ffc800, #ff9500);
      border: none;
      font-size: clamp(24px, 5vw, 34px);
      font-weight: 800;
      padding: clamp(12px, 2.5vw, 18px) clamp(35px, 6vw, 70px);
      border-radius: 70px;
      color: #141e2c;
      cursor: pointer;
      box-shadow: 0 10px 0 #b15d00, 0 10px 30px #ffaa33, 0 0 30px #ffd966;
      transition: 0.08s linear;
      text-transform: uppercase;
      white-space: nowrap;
      letter-spacing: 2px;
      text-shadow: 0 2px 5px #ffffff80;
    }

    .drop-ball-btn:active {
      transform: translateY(8px);
      box-shadow: 0 2px 0 #b15d00, 0 10px 30px #ffaa33;
    }

    .level-panel {
      display: flex;
      gap: clamp(8px, 1.8vw, 14px);
      margin-top: 18px;
      flex-wrap: wrap;
    }

    .level-btn {
      background: rgba(30, 45, 68, 0.6);
      backdrop-filter: blur(8px);
      border: 2px solid rgba(255, 215, 0, 0.5);
      color: #fff;
      font-size: clamp(14px, 2.8vw, 20px);
      font-weight: 700;
      padding: clamp(8px, 1.8vw, 12px) clamp(18px, 3.5vw, 35px);
      border-radius: 50px;
      cursor: pointer;
      transition: 0.2s;
      flex: 1;
      min-width: 100px;
      text-align: center;
      text-shadow: 0 0 8px gold;
      letter-spacing: 1px;
      box-shadow: 0 6px 0 #0f1a2a;
    }

    .level-btn.active {
      background: linear-gradient(145deg, #ffd966, #ffb347);
      border-color: #fff1b0;
      color: #1a2538;
      box-shadow: 0 6px 0 #b15d00, 0 0 30px #ffd966;
      transform: scale(1.05);
    }

    .level-btn.disabled {
      opacity: 0.4;
      pointer-events: none;
      filter: grayscale(0.8);
    }

    .star {
      position: fixed;
      background: white;
      border-radius: 50%;
      box-shadow: 0 0 20px white, 0 0 40px gold;
      pointer-events: none;
      z-index: 9999;
      animation: fallStarLinear 3s linear forwards;
    }

    @keyframes fallStarLinear {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
    }
  </style>
</head>
<body>
  <div class="welcome-screen" id="welcomeScreen">
    <div class="welcome-content">
      <div class="welcome-title">Íú±·¥ç·¥á·¥á·¥õ</div>
      <div class="welcome-subtitle">·¥ò ü…™…¥·¥ã·¥è ·¥Ö·¥á ü·¥úx·¥á</div>
      <div class="loading-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>

  <div class="app" id="app">
    <div class="header">
      <div class="balance-block">
        <span class="stars-icon">‚≠ê</span>
        <span class="balance-value" id="balanceDisplay">1000</span>
      </div>
      <button class="add-stars-btn" id="addStarsBtn">
        <span>‚ú®</span> +1000 ‚≠ê
      </button>
    </div>

    <div id="gamesMenu" class="games-menu">
      <div class="game-menu-item active" data-game="plinko">·¥ò ü…™…¥·¥ã·¥è</div>
      <div class="game-menu-item disabled" data-game="dice">·¥Ö…™·¥Ñ·¥á</div>
      <div class="game-menu-item disabled" data-game="slots">s ü·¥è·¥õs</div>
      <div class="game-menu-item disabled" data-game="roulette"> Ä·¥è·¥ú ü·¥á·¥õ·¥õ·¥á</div>
    </div>

    <div id="plinkoContainer">
      <div class="back-to-menu" id="backToMenuBtn">
        <span>‚Üê</span>  ô ·¥ç·¥á ú—é
      </div>
      
      <div class="canvas-wrapper">
        <canvas id="plinkoCanvas" width="952" height="700"></canvas>
      </div>

      <div class="plinko-controls">
        <div class="bet-section">
          <span class="bet-label">·¥Ñ·¥õ·¥Ä ô·¥ã·¥Ä ‚≠ê</span>
          <input type="number" id="betInput" class="bet-input" value="50" min="10" step="10">
        </div>
        <button class="drop-ball-btn" id="dropBallBtn">·¥ã…™ ú è·¥õ ô</button>
      </div>

      <div class="level-panel">
        <button class="level-btn active" data-level="easy">üå±  ü·¥á…¢·¥ã…™·¥ä</button>
        <button class="level-btn" data-level="medium">‚ö° ·¥Ñ·¥ò·¥á·¥Ö ú·¥á·¥á</button>
        <button class="level-btn" data-level="hard">üî• x·¥Ä·¥ò·¥Ö</button>
      </div>
    </div>
  </div>

  <script>
    (function() {
      function createStar() {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = '-10px';
        star.style.width = star.style.height = (Math.random() * 6 + 3) + 'px';
        star.style.animationDuration = (Math.random() * 4 + 3) + 's';
        star.style.animationDelay = Math.random() * 2 + 's';
        star.style.background = Math.random() > 0.7 ? '#ffd966' : '#ffffff';
        document.body.appendChild(star);
        setTimeout(() => star.remove(), 7000);
      }

      setInterval(createStar, 300);
      for (let i = 0; i < 30; i++) setTimeout(createStar, i * 50);

      const welcomeScreen = document.getElementById('welcomeScreen');
      const app = document.getElementById('app');
      const gamesMenu = document.getElementById('gamesMenu');
      const plinkoContainer = document.getElementById('plinkoContainer');

      setTimeout(() => {
        welcomeScreen.style.opacity = '0';
        setTimeout(() => {
          welcomeScreen.style.display = 'none';
          app.classList.add('visible');
          gamesMenu.style.display = 'flex';
          plinkoContainer.style.display = 'none';
        }, 1000);
      }, 3000);

      let balance = 1000;
      const balanceEl = document.getElementById('balanceDisplay');

      function updateBalance() {
        balanceEl.innerText = balance;
      }

      document.getElementById('addStarsBtn').addEventListener('click', () => {
        balance += 1000;
        updateBalance();
      });

      const backToMenuBtn = document.getElementById('backToMenuBtn');

      document.querySelectorAll('.game-menu-item').forEach(item => {
        item.addEventListener('click', () => {
          if (item.classList.contains('disabled')) return;
          
          const game = item.dataset.game;
          
          if (game === 'plinko') {
            gamesMenu.style.display = 'none';
            plinkoContainer.style.display = 'block';
            plinkoContainer.classList.add('active');
          }
        });
      });

      backToMenuBtn.addEventListener('click', () => {
        plinkoContainer.style.display = 'none';
        gamesMenu.style.display = 'flex';
      });

      const canvas = document.getElementById('plinkoCanvas');
      const ctx = canvas.getContext('2d');
      const width = 952, height = 700;

      let currentLevel = 'easy';
      let balls = [];
      let pins = [];
      let multipliers = [];
      let ballsInPlay = 0;
      
      let topPinPositions = [];

      const levelMultipliers = {
        easy:   [5.0, 3.0, 1.8, 1.2, 0.7, 0.3, 0.7, 1.2, 1.8, 3.0, 5.0],
        medium: [10.0, 5.0, 2.5, 1.5, 1.0, 0.5, 0.2, 0.5, 1.0, 1.5, 2.5, 5.0, 10.0],
        hard:   [50.0, 20.0, 10.0, 5.0, 2.5, 1.2, 0.5, 0.1, 0.5, 1.2, 2.5, 5.0, 10.0, 20.0, 50.0]
      };

      function setLevelButtonsState(disabled) {
        document.querySelectorAll('.level-btn').forEach(btn => {
          if (disabled) {
            btn.classList.add('disabled');
          } else {
            btn.classList.remove('disabled');
          }
        });
      }

      function generateField(level) {
        pins = [];
        topPinPositions = [];
        
        const mults = levelMultipliers[level];
        
        const rows = 14;
        const startY = 80;
        const pinR = 6;
        const spacingX = 48;
        const spacingY = 36;

        const maxCols = mults.length + 4;
        const totalW = (maxCols - 1) * spacingX;
        const offsetX = (width - totalW) / 2;

        for (let row = 0; row < rows; row++) {
          let cols;
          if (row < 6) cols = 6 + row;
          else if (row < 9) cols = 12;
          else cols = 21 - row;
          
          cols = Math.min(cols, mults.length + 5);
          
          const rowOffset = (maxCols - cols) * spacingX / 2;
          
          for (let col = 0; col < cols; col++) {
            const x = offsetX + rowOffset + col * spacingX + (row % 2 ? spacingX/2 : 0);
            const y = startY + row * spacingY;
            pins.push({ x, y, r: pinR });
            
            if (row === 0) {
              topPinPositions.push(x);
            }
          }
        }

        multipliers = [];
        const cellW = width / mults.length;
        for (let i = 0; i < mults.length; i++) {
          let color;
          const v = mults[i];
          if (v <= 0.5) color = '#6c7a96';
          else if (v <= 1.0) color = '#4f9fff';
          else if (v <= 2.0) color = '#42d692';
          else if (v <= 5.0) color = '#ffb347';
          else color = '#ff6b6b';
          
          multipliers.push({ 
            x: i * cellW, 
            w: cellW, 
            value: v, 
            color 
          });
        }
      }

      generateField(currentLevel);

      class Ball {
        constructor(x, y, bet) {
          this.x = x;
          this.y = y;
          this.vx = (Math.random() - 0.5) * 1.8;
          this.vy = 0.6;
          this.r = 9;
          this.bet = bet;
          this.trail = [];
          this.glowIntensity = Math.random() * 0.5 + 0.5;
          this.hue = 0;
        }

        update() {
          this.hue = (this.hue + 1) % 360;
          
          this.vy += 0.2;
          this.vx *= 0.99;
          
          this.x += this.vx;
          this.y += this.vy;
          
          this.trail.push({x: this.x, y: this.y, hue: this.hue});
          if (this.trail.length > 10) this.trail.shift();

          for (let p of pins) {
            const dx = this.x - p.x;
            const dy = this.y - p.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            const minDist = this.r + p.r;
            
            if (dist < minDist) {
              const angle = Math.atan2(dy, dx);
              const overlap = minDist - dist;
              this.x += Math.cos(angle) * overlap * 0.7;
              this.y += Math.sin(angle) * overlap * 0.7;
              
              const speed = Math.sqrt(this.vx*this.vx + this.vy*this.vy);
              if (speed > 0.1) {
                const nx = dx/dist;
                const ny = dy/dist;
                const dot = this.vx * nx + this.vy * ny;
                
                this.vx = (this.vx - 1.4 * dot * nx) * 0.7;
                this.vy = (this.vy - 1.4 * dot * ny) * 0.7;
                
                this.vx += (Math.random() - 0.5) * 0.4;
                this.vy += (Math.random() - 0.5) * 0.2;
              }
            }
          }

          if (this.x - this.r < 10) {
            this.x = 10 + this.r;
            this.vx *= -0.6;
          }
          if (this.x + this.r > width - 10) {
            this.x = width - 10 - this.r;
            this.vx *= -0.6;
          }

          if (this.y + this.r > height - 55) {
            const idx = Math.floor(this.x / (width / multipliers.length));
            if (idx >= 0 && idx < multipliers.length) {
              const win = Math.floor(this.bet * multipliers[idx].value);
              balance += win;
              updateBalance();
              flashCell(idx, win);
            }
            
            ballsInPlay--;
            if (ballsInPlay === 0) {
              setLevelButtonsState(false);
            }
            
            return false;
          }
          return true;
        }
      }

      let flash = { active: false, index: -1, alpha: 0, color: '#ffffff' };
      function flashCell(idx, winAmount) {
        flash.active = true;
        flash.index = idx;
        flash.alpha = 1.0;
        flash.color = winAmount > 0 ? '#ffd966' : '#ff8888';
      }

      function draw() {
        ctx.clearRect(0, 0, width, height);
        
        // –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —Ñ–æ–Ω
        const grad = ctx.createLinearGradient(0, 0, 0, height);
        grad.addColorStop(0, '#030614');
        grad.addColorStop(0.3, '#0a1a2f');
        grad.addColorStop(0.7, '#1a2a45');
        grad.addColorStop(1, '#0f1a30');
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, width, height);

        // –¢—É–º–∞–Ω–Ω–æ—Å—Ç—å
        for (let i = 0; i < 5; i++) {
          ctx.beginPath();
          ctx.arc(200 + i*150, 200 + i*80, 150, 0, Math.PI*2);
          ctx.fillStyle = `rgba(100, 150, 255, 0.
