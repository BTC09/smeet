<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>SMEET ‚ú¶ PLINKO</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      background: #03050a;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 8px;
    }

    /* ‚ú¶‚ú¶‚ú¶ –ü–†–ò–í–ï–¢–°–¢–í–ò–ï ‚ú¶‚ú¶‚ú¶ */
    .welcome-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 20% 30%, #1e2f4a, #020514);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      transition: opacity 0.8s ease;
    }

    .welcome-content {
      text-align: center;
      filter: drop-shadow(0 0 50px #ffbb33);
    }

    .welcome-title {
      font-size: clamp(80px, 20vw, 160px);
      font-weight: 900;
      background: linear-gradient(145deg, #fff5cf, #ffbb33, #ff8800);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 60px #ff8800, 0 0 120px #ff4400;
      letter-spacing: 12px;
      animation: glitchIn 1.2s;
    }

    .welcome-subtitle {
      font-size: clamp(24px, 6vw, 40px);
      color: #fff;
      text-shadow: 0 0 20px #3f9eff, 0 0 40px #1f4fbf;
      animation: fadeUp 1.2s 0.2s both;
    }

    @keyframes glitchIn {
      0% { transform: translateX(-100px) skewX(30deg); opacity: 0; filter: blur(20px); }
      60% { transform: translateX(10px) skewX(-10deg); }
      100% { transform: translateX(0) skewX(0); opacity: 1; filter: blur(0); }
    }

    @keyframes fadeUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* ‚ú¶‚ú¶‚ú¶ –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† ‚ú¶‚ú¶‚ú¶ */
    .app {
      width: 100%;
      max-width: 900px; /* –£–º–µ–Ω—å—à–∏–ª */
      background: rgba(12, 18, 28, 0.8);
      backdrop-filter: blur(16px);
      border-radius: 48px;
      padding: 18px;
      box-shadow: 0 30px 50px #000000cc, 0 0 0 2px #ffd96655 inset, 0 0 40px #ffaa3355;
      border: 1px solid #ffd96688;
      opacity: 0;
      transform: scale(0.96);
      transition: opacity 0.8s, transform 0.8s;
    }

    .app.visible {
      opacity: 1;
      transform: scale(1);
    }

    /* –®–∞–ø–∫–∞ */
    .header {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 80px;
      padding: 10px 18px;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1px solid #ffd96699;
      box-shadow: 0 6px 14px #00000080;
    }

    .balance-block {
      display: flex;
      align-items: center;
      gap: 12px;
      background: #0e1624;
      padding: 6px 20px 6px 14px;
      border-radius: 40px;
      border: 1px solid #ffd966;
    }

    .stars-icon {
      font-size: 28px;
      filter: drop-shadow(0 0 8px gold);
      animation: starSpin 3s infinite;
    }

    @keyframes starSpin {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(10deg); }
      75% { transform: rotate(-5deg); }
      100% { transform: rotate(0deg); }
    }

    .balance-value {
      font-size: 30px;
      font-weight: 800;
      background: linear-gradient(145deg, #ffd966, #ffb347);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .add-stars-btn {
      background: #1f2b3c;
      border: 2px solid #ffd966;
      color: #ffd966;
      font-size: 18px;
      font-weight: 700;
      padding: 8px 24px;
      border-radius: 40px;
      cursor: pointer;
      box-shadow: 0 5px 0 #0a121c, 0 0 15px #ffd96666;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: 0.1s;
    }

    .add-stars-btn:active {
      transform: translateY(4px);
      box-shadow: 0 1px 0 #0a121c, 0 0 20px #ffd966;
    }

    /* –ú–µ–Ω—é –∏–≥—Ä */
    .games-menu {
      display: flex;
      flex-direction: column;
      gap: 14px;
      padding: 10px 0;
    }

    .game-menu-item {
      background: #152232ee;
      backdrop-filter: blur(8px);
      border: 3px solid #ffd966;
      border-radius: 60px;
      padding: 20px;
      font-size: 42px;
      font-weight: 800;
      background: linear-gradient(145deg, #ffd966, #ffb347);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      cursor: pointer;
      text-align: center;
      box-shadow: 0 8px 0 #0f1a2a, 0 0 30px #ffaa33;
      transition: 0.1s;
    }

    .game-menu-item:active {
      transform: translateY(5px);
      box-shadow: 0 3px 0 #0f1a2a, 0 0 40px #ffd966;
    }

    .game-menu-item.disabled {
      opacity: 0.3;
      filter: grayscale(1);
    }

    /* –ü–õ–ò–ù–ö–û */
    #plinkoContainer {
      display: none;
    }

    #plinkoContainer.active {
      display: block;
      animation: fadePop 0.4s;
    }

    @keyframes fadePop {
      from { opacity: 0; transform: scale(0.96); }
      to { opacity: 1; transform: scale(1); }
    }

    .back-to-menu {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #1a2637;
      border: 2px solid #ffd966;
      color: #ffd966;
      font-size: 20px;
      font-weight: 600;
      padding: 8px 22px;
      border-radius: 50px;
      cursor: pointer;
      margin-bottom: 16px;
      box-shadow: 0 5px 0 #0f1a2a;
    }

    .canvas-wrapper {
      width: 100%;
      aspect-ratio: 860/600; /* –ù–µ–º–Ω–æ–≥–æ –Ω–∏–∂–µ */
      border-radius: 36px;
      overflow: hidden;
      background: #020812;
      box-shadow: 0 15px 30px #000, 0 0 0 2px #ffd96699 inset, 0 0 40px #ffaa3366;
      margin-bottom: 16px;
      position: relative;
    }

    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }

    .plinko-controls {
      background: #101a26ee;
      backdrop-filter: blur(8px);
      padding: 14px 18px;
      border-radius: 60px;
      border: 1px solid #ffd966;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
    }

    .bet-section {
      display: flex;
      align-items: center;
      gap: 14px;
      background: #0b121e;
      padding: 6px 18px;
      border-radius: 40px;
      border: 1px solid #ffd966aa;
    }

    .bet-label {
      color: #ffd966;
      font-size: 18px;
      font-weight: 600;
    }

    .bet-input {
      background: #1a2740;
      border: 2px solid #ffd966;
      color: #ffd966;
      font-size: 24px;
      font-weight: 700;
      width: 100px;
      padding: 8px 12px;
      border-radius: 40px;
      text-align: center;
    }

    .drop-ball-btn {
      background: linear-gradient(145deg, #ffcc00, #ff9900);
      border: none;
      font-size: 28px;
      font-weight: 800;
      padding: 12px 48px;
      border-radius: 60px;
      color: #121212;
      box-shadow: 0 7px 0 #aa5500, 0 0 25px #ffbb33;
      cursor: pointer;
      transition: 0.08s;
    }

    .drop-ball-btn:active {
      transform: translateY(6px);
      box-shadow: 0 1px 0 #aa5500, 0 0 30px #ffbb33;
    }

    .level-panel {
      display: flex;
      gap: 8px;
      margin-top: 14px;
    }

    .level-btn {
      background: #1b2537;
      border: 2px solid #ffd966aa;
      color: white;
      font-size: 16px;
      font-weight: 700;
      padding: 8px 16px;
      border-radius: 40px;
      cursor: pointer;
      flex: 1;
      text-align: center;
      box-shadow: 0 4px 0 #0f1a2a;
      transition: 0.1s;
    }

    .level-btn.active {
      background: linear-gradient(145deg, #ffd966, #ffb347);
      color: #121212;
      border-color: #fff0b0;
      box-shadow: 0 4px 0 #b15d00, 0 0 20px #ffd966;
      transform: scale(1.02);
    }

    .level-btn.disabled {
      opacity: 0.4;
      pointer-events: none;
    }

    /* –ü–∞–¥–∞—é—â–∏–µ –∑–≤—ë–∑–¥—ã (–º–µ–ª–∫–∏–µ) */
    .star {
      position: fixed;
      border-radius: 50%;
      background: white;
      box-shadow: 0 0 20px gold;
      pointer-events: none;
      z-index: 9999;
      animation: fall 3s linear forwards;
    }

    @keyframes fall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
  </style>
</head>
<body>
  <!-- –ü–†–ò–í–ï–¢ -->
  <div class="welcome-screen" id="welcomeScreen">
    <div class="welcome-content">
      <div class="welcome-title">Íú±·¥ç·¥á·¥á·¥õ</div>
      <div class="welcome-subtitle">·¥ò ü…™…¥·¥ã·¥è ·¥ò Ä·¥è</div>
    </div>
  </div>

  <!-- –û–°–ù–û–í–ê -->
  <div class="app" id="app">
    <div class="header">
      <div class="balance-block">
        <span class="stars-icon">‚ú¶</span>
        <span class="balance-value" id="balanceDisplay">1000</span>
      </div>
      <button class="add-stars-btn" id="addStarsBtn">‚ú® +1000</button>
    </div>

    <!-- –ú–ï–ù–Æ -->
    <div id="gamesMenu" class="games-menu">
      <div class="game-menu-item active" data-game="plinko">·¥ò ü…™…¥·¥ã·¥è</div>
      <div class="game-menu-item disabled">·¥Ö…™·¥Ñ·¥á</div>
      <div class="game-menu-item disabled">s ü·¥è·¥õs</div>
      <div class="game-menu-item disabled"> Ä·¥è·¥ú ü·¥á·¥õ·¥õ·¥á</div>
    </div>

    <!-- –ü–õ–ò–ù–ö–û -->
    <div id="plinkoContainer">
      <div class="back-to-menu" id="backToMenuBtn">‚Üê –≤ –º–µ–Ω—é</div>
      <div class="canvas-wrapper">
        <canvas id="plinkoCanvas" width="860" height="600"></canvas>
      </div>
      <div class="plinko-controls">
        <div class="bet-section">
          <span class="bet-label">‚ú¶</span>
          <input type="number" id="betInput" class="bet-input" value="50" min="10" step="10">
        </div>
        <button class="drop-ball-btn" id="dropBallBtn">üé≤</button>
      </div>
      <div class="level-panel">
        <button class="level-btn active" data-level="easy">üå± –õ–Å–ì–ö–ò–ô</button>
        <button class="level-btn" data-level="medium">‚ö° –°–†–ï–î–ù–ò–ô</button>
        <button class="level-btn" data-level="hard">üî• –•–ê–†–î</button>
      </div>
    </div>
  </div>

  <script>
    (function() {
      // ‚ú¶ –ó–≤—ë–∑–¥–æ—á–∫–∏ –ª–µ—Ç–∞—é—Ç
      for (let i = 0; i < 40; i++) {
        let s = document.createElement('div');
        s.className = 'star';
        s.style.left = Math.random() * 100 + '%';
        s.style.top = '-10px';
        s.style.width = s.style.height = (Math.random() * 5 + 2) + 'px';
        s.style.animationDuration = (Math.random() * 4 + 2) + 's';
        s.style.animationDelay = Math.random() * 2 + 's';
        s.style.background = Math.random() > 0.6 ? '#ffd966' : '#fff';
        document.body.appendChild(s);
        setTimeout(() => s.remove(), 7000);
      }
      setInterval(() => {
        let s = document.createElement('div');
        s.className = 'star';
        s.style.left = Math.random() * 100 + '%';
        s.style.top = '-10px';
        s.style.width = s.style.height = (Math.random() * 6 + 2) + 'px';
        s.style.animationDuration = (Math.random() * 4 + 2) + 's';
        s.style.background = Math.random() > 0.6 ? '#ffd966' : '#fff';
        document.body.appendChild(s);
        setTimeout(() => s.remove(), 5000);
      }, 200);

      // –≠–ª–µ–º–µ–Ω—Ç—ã
      const w = document.getElementById('welcomeScreen');
      const app = document.getElementById('app');
      const menu = document.getElementById('gamesMenu');
      const plinko = document.getElementById('plinkoContainer');

      setTimeout(() => {
        w.style.opacity = '0';
        setTimeout(() => {
          w.style.display = 'none';
          app.classList.add('visible');
          menu.style.display = 'flex';
          plinko.style.display = 'none';
        }, 800);
      }, 2500);

      // –ë–∞–ª–∞–Ω—Å
      let balance = 1000;
      const balSpan = document.getElementById('balanceDisplay');
      function upBal() { balSpan.innerText = balance; }
      document.getElementById('addStarsBtn').onclick = () => { balance += 1000; upBal(); };

      // –ù–∞–≤–∏–≥–∞—Ü–∏—è
      document.getElementById('backToMenuBtn').onclick = () => {
        plinko.style.display = 'none';
        menu.style.display = 'flex';
      };
      document.querySelector('.game-menu-item.active').onclick = () => {
        menu.style.display = 'none';
        plinko.style.display = 'block';
      };

      // ‚ú¶‚ú¶‚ú¶ PLINKO –í–°–Å –í–ù–£–¢–†–ò ‚ú¶‚ú¶‚ú¶
      const canvas = document.getElementById('plinkoCanvas');
      const ctx = canvas.getContext('2d');
      const ww = 860, hh = 600;

      let level = 'easy';
      let balls = [], pins = [], mults = [], ballsCount = 0, topPins = [];

      const multi = {
        easy:   [5.0, 3.0, 1.8, 1.2, 0.7, 0.3, 0.7, 1.2, 1.8, 3.0, 5.0],
        medium: [10.0,5.0,2.5,1.5,1.0,0.5,0.2,0.5,1.0,1.5,2.5,5.0,10.0],
        hard:   [50.0,20.0,10.0,5.0,2.5,1.2,0.5,0.1,0.5,1.2,2.5,5.0,10.0,20.0,50.0]
      };

      function blockLvl(dis) {
        document.querySelectorAll('.level-btn').forEach(b => {
          dis ? b.classList.add('disabled') : b.classList.remove('disabled');
        });
      }

      function generate(level) {
        pins = []; topPins = [];
        const m = multi[level];
        const rows = 13, startY = 70, pinR = 5.5, spX = 44, spY = 32;
        const maxCols = m.length + 4;
        const totalW = (maxCols - 1) * spX;
        const offX = (ww - totalW) / 2;

        for (let r = 0; r < rows; r++) {
          let cols = (r < 5) ? 6 + r : (r < 8) ? 11 : 19 - r;
          cols = Math.min(cols, m.length + 5);
          const rowOff = (maxCols - cols) * spX / 2;
          for (let c = 0; c < cols; c++) {
            let x = offX + rowOff + c * spX + (r % 2 ? spX/2 : 0);
            let y = startY + r * spY;
            pins.push({ x, y, r: pinR });
            if (r === 0) topPins.push(x);
          }
        }

        mults = [];
        const cellW = ww / m.length;
        for (let i = 0; i < m.length; i++) {
          let col;
          if (m[i] <= 0.5) col = '#6c7a96';
          else if (m[i] <= 1.0) col = '#4f9fff';
          else if (m[i] <= 2.0) col = '#42d692';
          else if (m[i] <= 5.0) col = '#ffb347';
          else col = '#ff6b6b';
          mults.push({ x: i * cellW, w: cellW, val: m[i], col });
        }
      }
      generate(level);

      class Ball {
        constructor(x, y, bet) {
          this.x = x; this.y = y; this.vx = (Math.random() - 0.5) * 1.7; this.vy = 0.5; this.r = 8; this.bet = bet; this.trail = []; this.hue = Math.random() * 360;
        }
        update() {
          this.hue = (this.hue + 2) % 360;
          this.vy += 0.19; this.vx *= 0.99;
          this.x += this.vx; this.y += this.vy;
          this.trail.push({ x: this.x, y: this.y, hue: this.hue });
          if (this.trail.length > 8) this.trail.shift();

          for (let p of pins) {
            let dx = this.x - p.x, dy = this.y - p.y, dist = Math.hypot(dx, dy), min = this.r + p.r;
            if (dist < min) {
              let a = Math.atan2(dy, dx), over = min - dist;
              this.x += Math.cos(a) * over * 0.7; this.y += Math.sin(a) * over * 0.7;
              let sp = Math.hypot(this.vx, this.vy);
              if (sp > 0.1) {
                let nx = dx / dist, ny = dy / dist, dot = this.vx * nx + this.vy * ny;
                this.vx = (this.vx - 1.4 * dot * nx) * 0.7;
                this.vy = (this.vy - 1.4 * dot * ny) * 0.7;
                this.vx += (Math.random() - 0.5) * 0.4;
                this.vy += (Math.random() - 0.5) * 0.2;
              }
            }
          }
          if (this.x - this.r < 8) { this.x = 8 + this.r; this.vx *= -0.6; }
          if (this.x + this.r > ww - 8) { this.x = ww - 8 - this.r; this.vx *= -0.6; }

          if (this.y + this.r > hh - 50) {
            let idx = Math.floor(this.x / (ww / mults.length));
            if (idx >= 0 && idx < mults.length) {
              balance += Math.floor(this.bet * mults[idx].val);
              upBal();
              flashIdx = idx; flashAlpha = 1;
            }
            ballsCount--;
            if (ballsCount === 0) blockLvl(false);
            return false;
          }
          return true;
        }
      }

      let flashIdx = -1, flashAlpha = 0;

      function draw() {
        ctx.clearRect(0, 0, ww, hh);
        // –§–∞–Ω—Å–∏ —Ñ–æ–Ω
        let grad = ctx.createLinearGradient(0, 0, 0, hh);
        grad.addColorStop(0, '#020514'); grad.addColorStop(0.5, '#132135'); grad.addColorStop(1, '#020514');
        ctx.fillStyle = grad; ctx.fillRect(0, 0, ww, hh);
        for (let i = 0; i < 5; i++) {
          ctx.beginPath(); ctx.arc(150 + i * 150, 200 + i * 40, 80, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(100,150,255,0.02)`; ctx.fill();
        }

        // –®—Ç—ã—Ä–∏ –±—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤—ã–µ
        pins.forEach(p => {
          ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
          let g = ctx.createRadialGradient(p.x-2, p.y-2, 2, p.x, p.y, p.r+3);
          g.addColorStop(0, '#fffacd'); g.addColorStop(0.5, '#ffd966'); g.addColorStop(1, '#b8860b');
          ctx.fillStyle = g; ctx.shadowColor = '#ffd966'; ctx.shadowBlur = 12; ctx.fill();
          ctx.shadowBlur = 0;
          ctx.beginPath(); ctx.arc(p.x-1.5, p.y-1.5, 1.8, 0, Math.PI*2);
          ctx.fillStyle = '#fff9e6'; ctx.fill();
        });

        // –Ø—á–µ–π–∫–∏
        mults.forEach((m, i) => {
          let gr = ctx.createLinearGradient(m.x, hh-50, m.x + m.w, hh-10);
          gr.addColorStop(0, m.col + 'aa'); gr.addColorStop(1, m.col + 'ff');
          ctx.fillStyle = gr; ctx.fillRect(m.x, hh-50, m.w-1, 40);
          if (flashIdx === i && flashAlpha > 0) {
            ctx.fillStyle = `rgba(255,255,255,${flashAlpha})`; ctx.fillRect(m.x, hh-50, m.w-1, 40);
            flashAlpha *= 0.5; if (flashAlpha < 0.05) flashIdx = -1;
          }
          ctx.strokeStyle = '#fff9e6'; ctx.lineWidth = 1.5; ctx.strokeRect(m.x, hh-50, m.w-1, 40);
          ctx.font = 'bold 18px Inter'; ctx.fillStyle = '#fff'; ctx.shadowColor = '#000'; ctx.shadowBlur = 6;
          ctx.fillText('x' + (m.val < 10 ? m.val.toFixed(1) : Math.round(m.val)), m.x + m.w/2, hh-25);
        });
        ctx.shadowBlur = 0;

        // –®–∞—Ä–∏–∫–∏
        balls.forEach(b => {
          b.trail.forEach((t, j) => {
            let a = (j / b.trail.length) * 0.3;
            ctx.beginPath(); ctx.arc(t.x, t.y, b.r*0.6, 0, Math.PI*2);
            ctx.fillStyle = `hsla(${t.hue}, 90%, 70%, ${a})`; ctx.fill();
          });
          ctx.shadowColor = `hsl(${b.hue}, 100%, 70%)`; ctx.shadowBlur = 22;
          ctx.beginPath(); ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
          let gr = ctx.createRadialGradient(b.x-3, b.y-3, 2, b.x, b.y, b.r+2);
          gr.addColorStop(0, `hsl(${b.hue}, 100%, 85%)`); gr.addColorStop(1, `hsl(${b.hue}, 100%, 45%)`);
          ctx.fillStyle = gr; ctx.fill();
          ctx.shadowBlur = 0;
          ctx.beginPath(); ctx.arc(b.x-2, b.y-2, 2, 0, Math.PI*2);
          ctx.fillStyle = '#ffffffaa'; ctx.fill();
        });
      }

      function loop() {
        for (let i = balls.length-1; i>=0; i--) if (!balls[i].update()) balls.splice(i,1);
        draw();
        requestAnimationFrame(loop);
      }
      loop();

      document.getElementById('dropBallBtn').onclick = () => {
        let bet = parseInt(document.getElementById('betInput').value) || 50;
        if (bet < 10) bet = 10;
        if (bet > balance) { alert('‚ú¶ –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç'); return; }
        balance -= bet; upBal();
        if (topPins.length) {
          let x = topPins[Math.floor(Math.random() * topPins.length)] + (Math.random()*8-4);
          balls.push(new Ball(x, 40, bet));
          ballsCount++; blockLvl(true);
        }
      };

      document.querySelectorAll('.level-btn').forEach(b => {
        b.onclick = () => {
          if (b.classList.contains('disabled')) return;
          document.querySelectorAll('.level-btn').forEach(bb => bb.classList.remove('active'));
          b.classList.add('active');
          level = b.dataset.level;
          generate(level);
        };
      });

      upBal();
    })();
  </script>
</body>
</html>
