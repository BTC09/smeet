<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>SMEET ‚ú¶ PLINKO</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      background: #03050a;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 8px;
    }

    /* ‚ú¶‚ú¶‚ú¶ –ü–†–ò–í–ï–¢–°–¢–í–ò–ï ‚ú¶‚ú¶‚ú¶ */
    .welcome-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 20% 30%, #1e2f4a, #020514);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      transition: opacity 0.8s ease;
    }

    .welcome-content {
      text-align: center;
      filter: drop-shadow(0 0 50px #ffbb33);
    }

    .welcome-title {
      font-size: clamp(80px, 20vw, 160px);
      font-weight: 900;
      background: linear-gradient(145deg, #fff5cf, #ffbb33, #ff8800);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 60px #ff8800, 0 0 120px #ff4400;
      letter-spacing: 12px;
      animation: glitchIn 1.2s;
    }

    .welcome-subtitle {
      font-size: clamp(24px, 6vw, 40px);
      color: #fff;
      text-shadow: 0 0 20px #3f9eff, 0 0 40px #1f4fbf;
      animation: fadeUp 1.2s 0.2s both;
    }

    @keyframes glitchIn {
      0% { transform: translateX(-100px) skewX(30deg); opacity: 0; filter: blur(20px); }
      60% { transform: translateX(10px) skewX(-10deg); }
      100% { transform: translateX(0) skewX(0); opacity: 1; filter: blur(0); }
    }

    @keyframes fadeUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* ‚ú¶‚ú¶‚ú¶ –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† ‚ú¶‚ú¶‚ú¶ */
    .app {
      width: 100%;
      max-width: 900px;
      background: rgba(12, 18, 28, 0.8);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-radius: 48px;
      padding: 18px;
      box-shadow: 0 30px 50px #000000cc, 0 0 0 2px #ffd96655 inset, 0 0 40px #ffaa3355;
      border: 1px solid #ffd96688;
      opacity: 0;
      transform: scale(0.96);
      transition: opacity 0.8s, transform 0.8s;
    }

    .app.visible {
      opacity: 1;
      transform: scale(1);
    }

    /* –®–∞–ø–∫–∞ —Å –±–∞–ª–∞–Ω—Å–æ–º */
    .header {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 80px;
      padding: 10px 18px;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1px solid #ffd96699;
      box-shadow: 0 6px 14px #00000080;
    }

    .balance-block {
      display: flex;
      align-items: center;
      gap: 12px;
      background: #0e1624;
      padding: 6px 20px 6px 14px;
      border-radius: 40px;
      border: 1px solid #ffd966;
      box-shadow: 0 0 15px #ffd96633 inset;
    }

    .stars-icon {
      font-size: 28px;
      filter: drop-shadow(0 0 8px gold);
      animation: starSpin 3s infinite;
    }

    @keyframes starSpin {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(10deg); }
      75% { transform: rotate(-5deg); }
      100% { transform: rotate(0deg); }
    }

    .balance-value {
      font-size: 30px;
      font-weight: 800;
      background: linear-gradient(145deg, #ffd966, #ffb347);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 10px #ffaa33;
    }

    .add-stars-btn {
      background: #1f2b3c;
      border: 2px solid #ffd966;
      color: #ffd966;
      font-size: 18px;
      font-weight: 700;
      padding: 8px 24px;
      border-radius: 40px;
      cursor: pointer;
      box-shadow: 0 5px 0 #0a121c, 0 0 15px #ffd96666;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: 0.1s;
      backdrop-filter: blur(4px);
    }

    .add-stars-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 0 #0a121c, 0 0 25px #ffd966;
    }

    .add-stars-btn:active {
      transform: translateY(4px);
      box-shadow: 0 1px 0 #0a121c, 0 0 20px #ffd966;
    }

    /* –ú–µ–Ω—é –∏–≥—Ä */
    .games-menu {
      display: flex;
      flex-direction: column;
      gap: 14px;
      padding: 10px 0;
    }

    .game-menu-item {
      background: #152232ee;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: 3px solid #ffd966;
      border-radius: 60px;
      padding: 20px;
      font-size: 42px;
      font-weight: 800;
      background: linear-gradient(145deg, #ffd966, #ffb347);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      cursor: pointer;
      text-align: center;
      box-shadow: 0 8px 0 #0f1a2a, 0 0 30px #ffaa33;
      transition: 0.1s;
      position: relative;
      overflow: hidden;
    }

    .game-menu-item::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at center, rgba(255,255,255,0.3), transparent 70%);
      animation: shine 4s infinite;
      pointer-events: none;
    }

    @keyframes shine {
      0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); opacity: 0; }
      20% { opacity: 0.4; }
      40% { transform: translateX(100%) translateY(100%) rotate(45deg); opacity: 0; }
    }

    .game-menu-item:active {
      transform: translateY(5px);
      box-shadow: 0 3px 0 #0f1a2a, 0 0 40px #ffd966;
    }

    .game-menu-item.disabled {
      opacity: 0.3;
      filter: grayscale(1);
      pointer-events: none;
    }

    /* –ü–õ–ò–ù–ö–û –ö–û–ù–¢–ï–ô–ù–ï–† */
    #plinkoContainer {
      display: none;
    }

    #plinkoContainer.active {
      display: block;
      animation: fadePop 0.4s;
    }

    @keyframes fadePop {
      from { opacity: 0; transform: scale(0.96); }
      to { opacity: 1; transform: scale(1); }
    }

    .back-to-menu {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #1a2637;
      border: 2px solid #ffd966;
      color: #ffd966;
      font-size: 20px;
      font-weight: 600;
      padding: 8px 22px;
      border-radius: 50px;
      cursor: pointer;
      margin-bottom: 16px;
      box-shadow: 0 5px 0 #0f1a2a;
      transition: 0.1s;
      backdrop-filter: blur(4px);
    }

    .back-to-menu:active {
      transform: translateY(4px);
      box-shadow: 0 1px 0 #0f1a2a;
    }

    /* –ö–ê–ù–í–ê–° */
    .canvas-wrapper {
      width: 100%;
      aspect-ratio: 860/600;
      border-radius: 36px;
      overflow: hidden;
      background: #020812;
      box-shadow: 0 15px 30px #000, 0 0 0 2px #ffd96699 inset, 0 0 40px #ffaa3366;
      margin-bottom: 16px;
      position: relative;
    }

    .canvas-wrapper::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 20% 30%, rgba(255,215,0,0.1), transparent 70%);
      pointer-events: none;
      z-index: 2;
    }

    canvas {
      display: block;
      width: 100%;
      height: 100%;
      background: #020812;
    }

    /* –ö–û–ù–¢–†–û–õ–´ */
    .plinko-controls {
      background: #101a26ee;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      padding: 14px 18px;
      border-radius: 60px;
      border: 1px solid #ffd966;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
      box-shadow: 0 8px 16px #00000066;
    }

    .bet-section {
      display: flex;
      align-items: center;
      gap: 14px;
      background: #0b121e;
      padding: 6px 18px;
      border-radius: 40px;
      border: 1px solid #ffd966aa;
      box-shadow: 0 0 15px #ffd96633 inset;
    }

    .bet-label {
      color: #ffd966;
      font-size: 18px;
      font-weight: 600;
      text-shadow: 0 0 8px #ffaa33;
    }

    .bet-input {
      background: #1a2740;
      border: 2px solid #ffd966;
      color: #ffd966;
      font-size: 24px;
      font-weight: 700;
      width: 100px;
      padding: 8px 12px;
      border-radius: 40px;
      text-align: center;
      outline: none;
      box-shadow: 0 0 10px #ffd96666;
    }

    .bet-input:focus {
      box-shadow: 0 0 20px #ffd966;
    }

    .drop-ball-btn {
      background: linear-gradient(145deg, #ffcc00, #ff9900);
      border: none;
      font-size: 28px;
      font-weight: 800;
      padding: 12px 48px;
      border-radius: 60px;
      color: #121212;
      box-shadow: 0 7px 0 #aa5500, 0 0 25px #ffbb33;
      cursor: pointer;
      transition: 0.08s;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .drop-ball-btn:active {
      transform: translateY(6px);
      box-shadow: 0 1px 0 #aa5500, 0 0 30px #ffbb33;
    }

    .level-panel {
      display: flex;
      gap: 8px;
      margin-top: 14px;
      flex-wrap: wrap;
    }

    .level-btn {
      background: #1b2537;
      border: 2px solid #ffd966aa;
      color: white;
      font-size: 16px;
      font-weight: 700;
      padding: 8px 16px;
      border-radius: 40px;
      cursor: pointer;
      flex: 1;
      min-width: 90px;
      text-align: center;
      box-shadow: 0 4px 0 #0f1a2a;
      transition: 0.1s;
      backdrop-filter: blur(4px);
      text-shadow: 0 0 8px gold;
    }

    .level-btn.active {
      background: linear-gradient(145deg, #ffd966, #ffb347);
      color: #121212;
      border-color: #fff0b0;
      box-shadow: 0 4px 0 #b15d00, 0 0 20px #ffd966;
      transform: scale(1.02);
      text-shadow: none;
    }

    .level-btn.disabled {
      opacity: 0.4;
      pointer-events: none;
      filter: grayscale(0.8);
    }

    /* –ü–∞–¥–∞—é—â–∏–µ –∑–≤—ë–∑–¥—ã */
    .star {
      position: fixed;
      border-radius: 50%;
      background: white;
      box-shadow: 0 0 20px gold, 0 0 40px orange;
      pointer-events: none;
      z-index: 9999;
      animation: fall 3s linear forwards;
    }

    @keyframes fall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
  </style>
</head>
<body>
  <!-- –ü–†–ò–í–ï–¢–°–¢–í–ò–ï -->
  <div class="welcome-screen" id="welcomeScreen">
    <div class="welcome-content">
      <div class="welcome-title">SMEET</div>
      <div class="welcome-subtitle">PLINKO PRO</div>
    </div>
  </div>

  <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† -->
  <div class="app" id="app">
    <!-- –®–ê–ü–ö–ê -->
    <div class="header">
      <div class="balance-block">
        <span class="stars-icon">‚ú¶</span>
        <span class="balance-value" id="balanceDisplay">1000</span>
      </div>
      <button class="add-stars-btn" id="addStarsBtn">‚ú® +1000</button>
    </div>

    <!-- –ú–ï–ù–Æ –ò–ì–† -->
    <div id="gamesMenu" class="games-menu">
      <div class="game-menu-item active" data-game="plinko">PLINKO</div>
      <div class="game-menu-item disabled" data-game="dice">DICE</div>
      <div class="game-menu-item disabled" data-game="slots">SLOTS</div>
      <div class="game-menu-item disabled" data-game="roulette">ROULETTE</div>
    </div>

    <!-- –ü–õ–ò–ù–ö–û -->
    <div id="plinkoContainer">
      <div class="back-to-menu" id="backToMenuBtn">‚Üê –í –ú–ï–ù–Æ</div>
      <div class="canvas-wrapper">
        <canvas id="plinkoCanvas" width="860" height="600"></canvas>
      </div>
      <div class="plinko-controls">
        <div class="bet-section">
          <span class="bet-label">‚ú¶</span>
          <input type="number" id="betInput" class="bet-input" value="50" min="10" step="10">
        </div>
        <button class="drop-ball-btn" id="dropBallBtn">–ö–ò–ù–£–¢–¨</button>
      </div>
      <div class="level-panel">
        <button class="level-btn active" data-level="easy">üå± –õ–Å–ì–ö–ò–ô</button>
        <button class="level-btn" data-level="medium">‚ö° –°–†–ï–î–ù–ò–ô</button>
        <button class="level-btn" data-level="hard">üî• –•–ê–†–î</button>
      </div>
    </div>
  </div>

  <script>
    (function() {
      // ==================== –ü–ê–î–ê–Æ–©–ò–ï –ó–í–Å–ó–î–´ ====================
      function createFallingStar() {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = '-10px';
        star.style.width = star.style.height = (Math.random() * 6 + 3) + 'px';
        star.style.animationDuration = (Math.random() * 4 + 2.5) + 's';
        star.style.animationDelay = Math.random() * 2 + 's';
        star.style.background = Math.random() > 0.6 ? '#ffd966' : '#ffffff';
        document.body.appendChild(star);
        setTimeout(() => star.remove(), 7000);
      }

      // –°—Ä–∞–∑—É —Å–æ–∑–¥–∞—ë–º –∫—É—á—É –∑–≤—ë–∑–¥
      for (let i = 0; i < 50; i++) {
        setTimeout(createFallingStar, i * 30);
      }
      
      // –ò –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ
      setInterval(createFallingStar, 300);

      // ==================== –≠–õ–ï–ú–ï–ù–¢–´ ====================
      const welcomeScreen = document.getElementById('welcomeScreen');
      const app = document.getElementById('app');
      const gamesMenu = document.getElementById('gamesMenu');
      const plinkoContainer = document.getElementById('plinkoContainer');
      const backToMenuBtn = document.getElementById('backToMenuBtn');
      const addStarsBtn = document.getElementById('addStarsBtn');
      const balanceDisplay = document.getElementById('balanceDisplay');
      const betInput = document.getElementById('betInput');
      const dropBallBtn = document.getElementById('dropBallBtn');
      const levelBtns = document.querySelectorAll('.level-btn');

      // ==================== –ü–†–ò–í–ï–¢–°–¢–í–ò–ï ====================
      setTimeout(() => {
        welcomeScreen.style.opacity = '0';
        setTimeout(() => {
          welcomeScreen.style.display = 'none';
          app.classList.add('visible');
          gamesMenu.style.display = 'flex';
          plinkoContainer.style.display = 'none';
        }, 800);
      }, 2500);

      // ==================== –ë–ê–õ–ê–ù–° ====================
      let balance = 1000;
      
      function updateBalance() {
        balanceDisplay.innerText = balance;
      }

      addStarsBtn.addEventListener('click', () => {
        balance += 1000;
        updateBalance();
      });

      // ==================== –ù–ê–í–ò–ì–ê–¶–ò–Ø ====================
      document.querySelectorAll('.game-menu-item').forEach(item => {
        item.addEventListener('click', () => {
          if (item.classList.contains('disabled')) return;
          
          if (item.dataset.game === 'plinko') {
            gamesMenu.style.display = 'none';
            plinkoContainer.style.display = 'block';
            plinkoContainer.classList.add('active');
          }
        });
      });

      backToMenuBtn.addEventListener('click', () => {
        plinkoContainer.style.display = 'none';
        gamesMenu.style.display = 'flex';
      });

      // ==================== PLINKO ====================
      const canvas = document.getElementById('plinkoCanvas');
      const ctx = canvas.getContext('2d');
      const width = 860, height = 600;

      let currentLevel = 'easy';
      let balls = [];
      let pins = [];
      let multipliers = [];
      let ballsInPlay = 0;
      let topPinPositions = [];

      // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è —É—Ä–æ–≤–Ω–µ–π (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –≤ —Ü–µ–Ω—Ç—Ä–µ, —Ä–∞—Å—Ç—É—Ç –∫ –∫—Ä–∞—è–º)
      const levelMultipliers = {
        easy:   [5.0, 3.0, 1.8, 1.2, 0.7, 0.3, 0.7, 1.2, 1.8, 3.0, 5.0],
        medium: [10.0, 5.0, 2.5, 1.5, 1.0, 0.5, 0.2, 0.5, 1.0, 1.5, 2.5, 5.0, 10.0],
        hard:   [50.0, 20.0, 10.0, 5.0, 2.5, 1.2, 0.5, 0.1, 0.5, 1.2, 2.5, 5.0, 10.0, 20.0, 50.0]
      };

      // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫ —É—Ä–æ–≤–Ω—è
      function setLevelButtonsState(disabled) {
        levelBtns.forEach(btn => {
          if (disabled) {
            btn.classList.add('disabled');
          } else {
            btn.classList.remove('disabled');
          }
        });
      }

      // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª—è
      function generateField(level) {
        pins = [];
        topPinPositions = [];
        
        const mults = levelMultipliers[level];
        const rows = 13;
        const startY = 70;
        const pinR = 5.5;
        const spacingX = 44;
        const spacingY = 32;

        const maxCols = mults.length + 4;
        const totalWidth = (maxCols - 1) * spacingX;
        const offsetX = (width - totalWidth) / 2;

        for (let row = 0; row < rows; row++) {
          let cols;
          if (row < 5) cols = 6 + row;
          else if (row < 8) cols = 11;
          else cols = 19 - row;
          
          cols = Math.min(cols, mults.length + 5);
          
          const rowOffset = (maxCols - cols) * spacingX / 2;
          
          for (let col = 0; col < cols; col++) {
            const x = offsetX + rowOffset + col * spacingX + (row % 2 ? spacingX/2 : 0);
            const y = startY + row * spacingY;
            pins.push({ x, y, r: pinR });
            
            if (row === 0) {
              topPinPositions.push(x);
            }
          }
        }

        // –Ø—á–µ–π–∫–∏ —Å –º–Ω–æ–∂–∏—Ç–µ–ª—è–º–∏
        multipliers = [];
        const cellWidth = width / mults.length;
        for (let i = 0; i < mults.length; i++) {
          let color;
          const val = mults[i];
          if (val <= 0.5) color = '#6c7a96';
          else if (val <= 1.0) color = '#4f9fff';
          else if (val <= 2.0) color = '#42d692';
          else if (val <= 5.0) color = '#ffb347';
          else color = '#ff6b6b';
          
          multipliers.push({ 
            x: i * cellWidth, 
            width: cellWidth, 
            value: val, 
            color: color 
          });
        }
      }

      // –ù–∞—á–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
      generateField(currentLevel);

      // –ö–ª–∞—Å—Å —à–∞—Ä–∏–∫–∞
      class Ball {
        constructor(x, y, bet) {
          this.x = x;
          this.y = y;
          this.vx = (Math.random() - 0.5) * 1.7;
          this.vy = 0.5;
          this.radius = 8;
          this.bet = bet;
          this.trail = [];
          this.hue = Math.random() * 360;
        }

        update() {
          // –ú–µ–Ω—è–µ–º –æ—Ç—Ç–µ–Ω–æ–∫ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–µ—Ä–µ–ª–∏–≤–∞–Ω–∏—è
          this.hue = (this.hue + 2) % 360;
          
          // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
          this.vy += 0.19;
          
          // –¢—Ä–µ–Ω–∏–µ
          this.vx *= 0.99;
          
          // –î–≤–∏–∂–µ–Ω–∏–µ
          this.x += this.vx;
          this.y += this.vy;
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ª–µ–¥
          this.trail.push({ x: this.x, y: this.y, hue: this.hue });
          if (this.trail.length > 8) this.trail.shift();

          // –û—Ç—Å–∫–æ–∫–∏ –æ—Ç —à—Ç—ã—Ä–µ–π
          for (let p of pins) {
            const dx = this.x - p.x;
            const dy = this.y - p.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            const minDist = this.radius + p.r;
            
            if (dist < minDist) {
              const angle = Math.atan2(dy, dx);
              const overlap = minDist - dist;
              this.x += Math.cos(angle) * overlap * 0.7;
              this.y += Math.sin(angle) * overlap * 0.7;
              
              const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
              if (speed > 0.1) {
                const nx = dx / dist;
                const ny = dy / dist;
                const dot = this.vx * nx + this.vy * ny;
                
                this.vx = (this.vx - 1.4 * dot * nx) * 0.7;
                this.vy = (this.vy - 1.4 * dot * ny) * 0.7;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–º–Ω–æ–≥–æ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏
                this.vx += (Math.random() - 0.5) * 0.4;
                this.vy += (Math.random() - 0.5) * 0.2;
              }
            }
          }

          // –°—Ç–µ–Ω—ã
          if (this.x - this.radius < 8) {
            this.x = 8 + this.radius;
            this.vx *= -0.6;
          }
          if (this.x + this.radius > width - 8) {
            this.x = width - 8 - this.radius;
            this.vx *= -0.6;
          }

          // –î–æ—Å—Ç–∏–≥ –¥–Ω–∞?
          if (this.y + this.radius > height - 50) {
            const idx = Math.floor(this.x / (width / multipliers.length));
            if (idx >= 0 && idx < multipliers.length) {
              const win = Math.floor(this.bet * multipliers[idx].value);
              balance += win;
              updateBalance();
              flashCell(idx, win);
            }
            
            ballsInPlay--;
            if (ballsInPlay === 0) {
              setLevelButtonsState(false);
            }
            
            return false;
          }
          return true;
        }
      }

      // –≠—Ñ—Ñ–µ–∫—Ç –≤—Å–ø—ã—à–∫–∏
      let flashData = { active: false, index: -1, alpha: 0 };
      
      function flashCell(index, winAmount) {
        flashData.active = true;
        flashData.index = index;
        flashData.alpha = 1.0;
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
      function draw() {
        ctx.clearRect(0, 0, width, height);
        
        // –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç —Ñ–æ–Ω–∞
        const bgGrad = ctx.createLinearGradient(0, 0, 0, height);
        bgGrad.addColorStop(0, '#020514');
        bgGrad.addColorStop(0.5, '#132135');
        bgGrad.addColorStop(1, '#020514');
        ctx.fillStyle = bgGrad;
        ctx.fillRect(0, 0, width, height);

        // –¢—É–º–∞–Ω–Ω–æ—Å—Ç–∏
        for (let i = 0; i < 5; i++) {
          ctx.beginPath();
          ctx.arc(150 + i * 150, 200 + i * 40, 80, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(100, 150, 255, 0.02)`;
          ctx.fill();
        }

        // –ú–µ–ª–∫–∏–µ –∑–≤–µ–∑–¥—ã –Ω–∞ –∫–∞–Ω–≤–∞—Å–µ
        for (let i = 0; i < 20; i++) {
          const time = Date.now() * 0.001;
          const x = (i * 60 + time * 20) % width;
          const y = (i * 40 + time * 5) % height;
          
          ctx.beginPath();
          ctx.arc(x, y, 1, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(255, 255, 255, 0.4)`;
          ctx.fill();
        }

        // –†–∏—Å—É–µ–º —à—Ç—ã—Ä–∏
        pins.forEach(p => {
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
          
          const pinGrad = ctx.createRadialGradient(p.x - 2, p.y - 2, 2, p.x, p.y, p.r + 3);
          pinGrad.addColorStop(0, '#fffacd');
          pinGrad.addColorStop(0.5, '#ffd966');
          pinGrad.addColorStop(1, '#b8860b');
          
          ctx.fillStyle = pinGrad;
          ctx.shadowColor = '#ffd966';
          ctx.shadowBlur = 12;
          ctx.fill();
          
          ctx.shadowBlur = 0;
          
          // –ë–ª–∏–∫ –Ω–∞ —à—Ç—ã—Ä–µ
          ctx.beginPath();
          ctx.arc(p.x - 1.5, p.y - 1.5, 1.8, 0, Math.PI * 2);
          ctx.fillStyle = '#fff9e6';
          ctx.fill();
        });

        // –†–∏—Å—É–µ–º —è—á–µ–π–∫–∏ —Å –º–Ω–æ–∂–∏—Ç–µ–ª—è–º–∏
        multipliers.forEach((m, i) => {
          const cellGrad = ctx.createLinearGradient(m.x, height - 50, m.x + m.width, height - 10);
          cellGrad.addColorStop(0, m.color + 'aa');
          cellGrad.addColorStop(1, m.color + 'ff');
          
          ctx.fillStyle = cellGrad;
          ctx.fillRect(m.x, height - 50, m.width - 1, 40);
          
          // –≠—Ñ—Ñ–µ–∫—Ç –≤—Å–ø—ã—à–∫–∏
          if (flashData.active && flashData.index === i) {
            ctx.fillStyle = `rgba(255, 255, 255, ${flashData.alpha})`;
            ctx.fillRect(m.x, height - 50, m.width - 1, 40);
            flashData.alpha *= 0.5;
            if (flashData.alpha < 0.05) flashData.active = false;
          }
          
          ctx.strokeStyle = '#fff9e6';
          ctx.lineWidth = 1.5;
          ctx.strokeRect(m.x, height - 50, m.width - 1, 40);
          
          ctx.font = 'bold 18px "Inter", "Segoe UI"';
          ctx.fillStyle = '#ffffff';
          ctx.shadowColor = '#000';
          ctx.shadowBlur = 6;
          ctx.textAlign = 'center';
          
          let text = m.value < 10 ? m.value.toFixed(1) : 'x' + Math.round(m.value);
          if (m.value < 1) text = m.value.toFixed(1);
          else if (m.value < 10) text = 'x' + m.value.toFixed(1);
          else text = 'x' + Math.round(m.value);
          
          ctx.fillText(text, m.x + m.width / 2, height - 27);
        });
        ctx.shadowBlur = 0;

        // –†–∏—Å—É–µ–º —à–∞—Ä–∏–∫–∏
        balls.forEach(b => {
          // –°–ª–µ–¥
          b.trail.forEach((t, j) => {
            const alpha = (j / b.trail.length) * 0.4;
            ctx.beginPath();
            ctx.arc(t.x, t.y, b.radius * 0.6, 0, Math.PI * 2);
            ctx.fillStyle = `hsla(${t.hue}, 90%, 70%, ${alpha})`;
            ctx.fill();
          });
          
          // –°–∏—è–Ω–∏–µ
          ctx.shadowColor = `hsl(${b.hue}, 100%, 70%)`;
          ctx.shadowBlur = 22;
          
          // –®–∞—Ä
          ctx.beginPath();
          ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
          
          const ballGrad = ctx.createRadialGradient(b.x - 3, b.y - 3, 2, b.x, b.y, b.radius + 2);
          ballGrad.addColorStop(0, `hsl(${b.hue}, 100%, 85%)`);
          ballGrad.addColorStop(0.6, `hsl(${b.hue}, 100%, 55%)`);
          ballGrad.addColorStop(1, `hsl(${b.hue}, 100%, 35%)`);
          
          ctx.fillStyle = ballGrad;
          ctx.fill();
          
          ctx.shadowBlur = 0;
          
          // –ë–ª–∏–∫
          ctx.beginPath();
          ctx.arc(b.x - 2, b.y - 2, 2, 0, Math.PI * 2);
          ctx.fillStyle = '#ffffffaa';
          ctx.fill();
        });
      }

      // –ê–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ü–∏–∫–ª
      function gameLoop() {
        for (let i = balls.length - 1; i >= 0; i--) {
          if (!balls[i].update()) {
            balls.splice(i, 1);
          }
        }
        draw();
        requestAnimationFrame(gameLoop);
      }
      gameLoop();

      // –ö–Ω–æ–ø–∫–∞ –±—Ä–æ—Å–∫–∞
      dropBallBtn.addEventListener('click', () => {
        let bet = parseInt(betInput.value);
        if (isNaN(bet) || bet < 10) bet = 10;
        if (bet > balance) {
          alert('‚ú¶ –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∑–≤—ë–∑–¥!');
          return;
        }
        
        balance -= bet;
        updateBalance();
        
        if (topPinPositions.length > 0) {
          const randomIndex = Math.floor(Math.random() * topPinPositions.length);
          const startX = topPinPositions[randomIndex] + (Math.random() * 8 - 4);
          
          balls.push(new Ball(startX, 40, bet));
          
          ballsInPlay++;
          setLevelButtonsState(true);
        }
      });

      // –°–º–µ–Ω–∞ —É—Ä–æ–≤–Ω—è
      levelBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          if (btn.classList.contains('disabled')) return;
          
          levelBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentLevel = btn.dataset.level;
          generateField(currentLevel);
        });
      });

      // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
      betInput.addEventListener('change', function() {
        let val = parseInt(this.value);
        if (val < 10) this.value = 10;
        if (val > 10000) this.value = 10000;
      });

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞
      updateBalance();
    })();
  </script>
</body>
</html>
